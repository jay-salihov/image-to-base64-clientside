<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image to Base64 Converter | Client-Side Tool</title>
    <meta name="description" content="Free online tool to convert images to base64 and decode base64 back to images. All processing happens in your browser - no server upload required.">
    <meta name="keywords" content="image to base64, base64 to image, image converter, base64 encoder, base64 decoder, client-side converter">
    <meta name="author" content="Image Tools">
    <meta name="robots" content="index, follow">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Image to Base64 Converter">
    <meta property="og:description" content="Free online tool to convert images to base64 and decode base64 back to images.">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Image to Base64 Converter">
    <meta name="twitter:description" content="Free online tool to convert images to base64 and decode base64 back to images.">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/daisyui/4.7.2/full.min.css" rel="stylesheet" type="text/css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
</head>
<body class="min-h-screen bg-base-300">
    <div class="container mx-auto p-4 max-w-3xl">
        <h1 class="text-3xl font-bold mb-8 text-center">Image to Base64 Converter</h1>

        <!-- Image to Base64 Section -->
        <div class="card bg-base-100 shadow-xl mb-8">
            <div class="card-body">
                <h2 class="card-title mb-4">Image to Base64</h2>
                <div class="form-control">
                    <label class="label">
                        <span class="label-text">Select an image file</span>
                    </label>
                    <input type="file" id="imageInput" accept="image/*" class="file-input file-input-bordered w-full">
                </div>
                <div id="imagePreview" class="mt-4 hidden">
                    <label class="label">
                        <span class="label-text">Preview:</span>
                    </label>
                    <div class="flex justify-center p-4 bg-base-200 rounded-lg">
                        <img id="previewImg" class="max-w-full max-h-64 rounded" alt="Preview">
                    </div>
                    <div class="mt-2 text-sm text-base-content/70" id="imageInfo"></div>
                </div>
                <button class="btn btn-primary w-full text-white mt-4" id="convertBtn" disabled>Convert to Base64</button>
                <div class="form-control mt-4 hidden" id="base64OutputSection">
                    <label class="label">
                        <span class="label-text">Base64 Output:</span>
                    </label>
                    <textarea id="base64Output" class="textarea textarea-bordered w-full h-48" readonly></textarea>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mt-2">
                        <button class="btn btn-secondary text-white" id="copyBase64Btn">Copy Base64</button>
                        <button class="btn btn-secondary text-white" id="copyDataUrlBtn">Copy Data URL</button>
                    </div>
                    <div id="copyMessage" class="mt-2 min-h-[24px]"></div>
                </div>
            </div>
        </div>

        <!-- Base64 to Image Section -->
        <div class="card bg-base-100 shadow-xl mb-8">
            <div class="card-body">
                <h2 class="card-title mb-4">Base64 to Image</h2>
                <div class="form-control">
                    <label class="label">
                        <span class="label-text">Paste Base64 string (with or without data URL prefix)</span>
                    </label>
                    <textarea id="base64Input" placeholder="data:image/png;base64,iVBORw0KG..." class="textarea textarea-bordered w-full h-32"></textarea>
                </div>
                <button class="btn btn-primary w-full text-white mt-4" id="decodeBtn">Decode to Image</button>
                <div id="decodeError" class="mt-2 text-error hidden"></div>
                <div class="form-control mt-4 hidden" id="decodedImageSection">
                    <label class="label">
                        <span class="label-text">Decoded Image:</span>
                    </label>
                    <div class="flex justify-center p-4 bg-base-200 rounded-lg">
                        <img id="decodedImg" class="max-w-full max-h-64 rounded" alt="Decoded">
                    </div>
                    <div class="mt-2 text-sm text-base-content/70" id="decodedImageInfo"></div>
                    <button class="btn btn-secondary mt-2 text-white" id="downloadBtn">Download Image</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Constants
        const BUTTON_DISABLED_COLOR = '#374151'; // Dark gray
        let BUTTON_COLOR; // Will be set on page load

        // Get initial button color
        document.addEventListener('DOMContentLoaded', () => {
            const convertBtn = document.getElementById('convertBtn');
            BUTTON_COLOR = window.getComputedStyle(convertBtn).backgroundColor;
        });

        // Global variables
        let currentImageFile = null;
        let currentBase64 = null;
        let currentDataUrl = null;

        // Utility Functions
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round((bytes / Math.pow(k, i)) * 100) / 100 + ' ' + sizes[i];
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function animateProgress(button, startTime, duration, progress, color) {
            const currentTime = Date.now();
            const elapsed = currentTime - startTime;
            const progressPercentage = Math.min((elapsed / duration) * 100, progress);

            button.style.background = `linear-gradient(to right, ${color} ${progressPercentage}%, ${BUTTON_DISABLED_COLOR} ${progressPercentage}%)`;

            if (elapsed < duration && progressPercentage < progress) {
                requestAnimationFrame(() => animateProgress(button, startTime, duration, progress, color));
            }
        }

        // Image to Base64 Functions
        document.getElementById('imageInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) {
                document.getElementById('imagePreview').classList.add('hidden');
                document.getElementById('convertBtn').disabled = true;
                document.getElementById('base64OutputSection').classList.add('hidden');
                currentImageFile = null;
                return;
            }

            // Validate file type
            if (!file.type.startsWith('image/')) {
                alert('Please select a valid image file');
                this.value = '';
                return;
            }

            currentImageFile = file;

            // Show preview
            const reader = new FileReader();
            reader.onload = function(e) {
                const previewImg = document.getElementById('previewImg');
                previewImg.src = e.target.result;
                document.getElementById('imagePreview').classList.remove('hidden');

                // Show image info
                const img = new Image();
                img.onload = function() {
                    document.getElementById('imageInfo').textContent =
                        `Size: ${formatFileSize(file.size)} | Dimensions: ${img.width}x${img.height} | Type: ${file.type}`;
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);

            // Enable convert button
            document.getElementById('convertBtn').disabled = false;

            // Hide previous output
            document.getElementById('base64OutputSection').classList.add('hidden');
        });

        document.getElementById('convertBtn').addEventListener('click', async function() {
            if (!currentImageFile) return;

            const convertBtn = this;
            const base64Output = document.getElementById('base64Output');
            const base64OutputSection = document.getElementById('base64OutputSection');

            convertBtn.disabled = true;
            convertBtn.style.cssText = `
                background: linear-gradient(to right, ${BUTTON_COLOR} 0%, ${BUTTON_DISABLED_COLOR} 0%);
                opacity: 1 !important;
            `;

            const startTime = Date.now();
            const minDuration = 500;

            // Animate to 50%
            animateProgress(convertBtn, startTime, minDuration, 50, BUTTON_COLOR);

            const reader = new FileReader();
            reader.onload = async function(e) {
                currentDataUrl = e.target.result;
                // Extract base64 part (remove data:image/xxx;base64, prefix)
                currentBase64 = currentDataUrl.split(',')[1];

                // Animate to 100%
                animateProgress(convertBtn, startTime, minDuration, 100, BUTTON_COLOR);

                // Wait for minimum duration
                const elapsedTime = Date.now() - startTime;
                if (elapsedTime < minDuration) {
                    await sleep(minDuration - elapsedTime);
                }

                base64Output.value = currentBase64;
                base64OutputSection.classList.remove('hidden');

                convertBtn.style.cssText = `
                    background: ${BUTTON_COLOR};
                    opacity: 1 !important;
                `;
                convertBtn.disabled = false;
            };
            reader.readAsDataURL(currentImageFile);
        });

        document.getElementById('copyBase64Btn').addEventListener('click', function() {
            const base64Output = document.getElementById('base64Output');
            base64Output.select();
            document.execCommand('copy');

            const copyMessage = document.getElementById('copyMessage');
            copyMessage.textContent = 'Base64 copied to clipboard!';
            copyMessage.className = 'text-success';
            setTimeout(() => {
                copyMessage.textContent = '';
            }, 3000);
        });

        document.getElementById('copyDataUrlBtn').addEventListener('click', function() {
            if (!currentDataUrl) return;

            const textarea = document.createElement('textarea');
            textarea.value = currentDataUrl;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);

            const copyMessage = document.getElementById('copyMessage');
            copyMessage.textContent = 'Data URL copied to clipboard!';
            copyMessage.className = 'text-success';
            setTimeout(() => {
                copyMessage.textContent = '';
            }, 3000);
        });

        // Base64 to Image Functions
        document.getElementById('decodeBtn').addEventListener('click', async function() {
            const base64Input = document.getElementById('base64Input');
            const decodeError = document.getElementById('decodeError');
            const decodedImageSection = document.getElementById('decodedImageSection');
            const decodeBtn = this;

            let base64String = base64Input.value.trim();

            if (!base64String) {
                decodeError.textContent = 'Please enter a base64 string';
                decodeError.classList.remove('hidden');
                return;
            }

            decodeBtn.disabled = true;
            decodeBtn.style.cssText = `
                background: linear-gradient(to right, ${BUTTON_COLOR} 0%, ${BUTTON_DISABLED_COLOR} 0%);
                opacity: 1 !important;
            `;

            const startTime = Date.now();
            const minDuration = 500;

            // Animate to 50%
            animateProgress(decodeBtn, startTime, minDuration, 50, BUTTON_COLOR);

            try {
                // Check if it's a data URL or just base64
                let dataUrl;
                if (base64String.startsWith('data:')) {
                    dataUrl = base64String;
                } else {
                    // Try to detect image type from base64 header
                    const base64Header = base64String.substring(0, 20);
                    let mimeType = 'image/png'; // Default

                    if (base64String.startsWith('/9j/')) {
                        mimeType = 'image/jpeg';
                    } else if (base64String.startsWith('iVBORw0KGg')) {
                        mimeType = 'image/png';
                    } else if (base64String.startsWith('R0lGOD')) {
                        mimeType = 'image/gif';
                    } else if (base64String.startsWith('UklGR')) {
                        mimeType = 'image/webp';
                    }

                    dataUrl = `data:${mimeType};base64,${base64String}`;
                }

                // Test if the base64 is valid by loading it
                const img = new Image();

                img.onload = async function() {
                    // Animate to 100%
                    animateProgress(decodeBtn, startTime, minDuration, 100, BUTTON_COLOR);

                    // Wait for minimum duration
                    const elapsedTime = Date.now() - startTime;
                    if (elapsedTime < minDuration) {
                        await sleep(minDuration - elapsedTime);
                    }

                    document.getElementById('decodedImg').src = dataUrl;

                    // Calculate approximate file size from base64 length
                    const base64Length = base64String.replace(/^data:image\/\w+;base64,/, '').length;
                    const sizeInBytes = (base64Length * 3) / 4;

                    document.getElementById('decodedImageInfo').textContent =
                        `Dimensions: ${img.width}x${img.height} | Approximate size: ${formatFileSize(sizeInBytes)}`;

                    decodedImageSection.classList.remove('hidden');
                    decodeError.classList.add('hidden');

                    decodeBtn.style.cssText = `
                        background: ${BUTTON_COLOR};
                        opacity: 1 !important;
                    `;
                    decodeBtn.disabled = false;
                };

                img.onerror = function() {
                    decodeError.textContent = 'Invalid base64 image data';
                    decodeError.classList.remove('hidden');
                    decodedImageSection.classList.add('hidden');

                    decodeBtn.style.cssText = `
                        background: ${BUTTON_COLOR};
                        opacity: 1 !important;
                    `;
                    decodeBtn.disabled = false;
                };

                img.src = dataUrl;

            } catch (error) {
                decodeError.textContent = 'Error decoding base64: ' + error.message;
                decodeError.classList.remove('hidden');
                decodedImageSection.classList.add('hidden');

                decodeBtn.style.cssText = `
                    background: ${BUTTON_COLOR};
                    opacity: 1 !important;
                `;
                decodeBtn.disabled = false;
            }
        });

        document.getElementById('downloadBtn').addEventListener('click', function() {
            const decodedImg = document.getElementById('decodedImg');
            const link = document.createElement('a');
            link.href = decodedImg.src;

            // Try to determine file extension from data URL
            let extension = 'png';
            const dataUrl = decodedImg.src;
            if (dataUrl.includes('image/jpeg') || dataUrl.includes('image/jpg')) {
                extension = 'jpg';
            } else if (dataUrl.includes('image/gif')) {
                extension = 'gif';
            } else if (dataUrl.includes('image/webp')) {
                extension = 'webp';
            }

            link.download = `decoded-image-${Date.now()}.${extension}`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });

        // Input validation for base64 textarea
        document.getElementById('base64Input').addEventListener('input', function() {
            document.getElementById('decodeError').classList.add('hidden');
        });
    </script>
</body>
</html>
